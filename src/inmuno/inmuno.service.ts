import { Injectable } from '@nestjs/common';
const fs = require('fs')
const fetch = require('node-fetch');


@Injectable()
export class InmunoService {
    construct

    descargarRptPlano(){

        const rpt = fs.createWriteStream('./mayo20201.csv');
        const dest = fs.createWriteStream('./PACIENTE.csv');

        fetch("https://wsalud.minsa.gob.pe/reporteshis/his/NominalTramaNuevo.aspx?parametro=7-7-----20190101-20190131", {
            "headers": {
              "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
              "accept-language": "es-ES,es;q=0.9,en;q=0.8",
              "cache-control": "no-cache",
              "content-type": "application/x-www-form-urlencoded",
              "pragma": "no-cache",
              "sec-fetch-dest": "iframe",
              "sec-fetch-mode": "navigate",
              "sec-fetch-site": "same-origin",
              "sec-fetch-user": "?1",
              "upgrade-insecure-requests": "1",
              "cookie": "_ga=GA1.3.2012850145.1568573608; __cfduid=d46499b35542facd31f0e4f4f12ad92541602259280; rxVisitor=1603823334071H7F048O6UFUH47TL5KMLAJE01T1NVVKF; ASP.NET_SessionId=s1aoilx1hsyonuvwjpmhip2k; dtSa=true%7CC%7C-1%7Cmlkuser%7C-%7C1604328192888%7C525672842_0%7Chttps%3A%2F%2Fwebsalud.minsa.gob.pe%2Fhisminsa%2F%7CHIS%20MINSA%7C1604328191950%7C; dtPC=2$528203045_723h-vKAJKAIPPKHBOLGFEDKOGNLJVHMKNGBNP; dtCookie=2$C6AF3BBAE598A73479D3CDCE1FCC65FE|HISMINSA|1; rxvt=1604330007109|1604325672864; dtLatC=3"
            },
            "referrer": "https://wsalud.minsa.gob.pe/reporteshis/his/NominalTramaNuevo.aspx?parametro=7-7-----20190301-20190331",
            "referrerPolicy": "strict-origin-when-cross-origin",
            "body": "__EVENTTARGET=&__EVENTARGUMENT=&__VIEWSTATE=%2FwEPDwULLTEwMTQzMzA4NTAPZBYCAgMPZBYEAgMPDxYCHgRUZXh0BRpUb3RhbCBkZSByZWdpc3Ryb3MgMTU1MTU3MGRkAgUPPCsAHAIADxYCHg9EYXRhU291cmNlQm91bmRnZBg8KwAGAQUUKwACZGRkGAEFHl9fQ29udHJvbHNSZXF1aXJlUG9zdEJhY2tLZXlfXxYBBQJndtLV3n2FDmg4HH8cE74NcIyWylxKCUbKJnthBV9BMVtv&__VIEWSTATEGENERATOR=40BBBC33&__EVENTVALIDATION=%2FwEdAAuYsVkFRM9tOyfTcH39pYil60z594LnSzU4S6PQAbT3rq%2FpNZX4WBzijQTqPezGz2dA7gw86B%2By7ZHTN%2BvyabRRNnYkKrbN%2FO3%2F80cAQIl6hUr4E8rNR8j1g%2BULBBtNNPuHCckrAtLUuxosmebAadYwj4xXkHQ%2BYn1IHjIKmCBZQcd656%2BJOgSd%2B0%2FH49X4pDTceTYcQ5kHq6daWfdlKKqcYwT%2BSUyhF5e0clSSWBJgLgh%2BDkRYSjUwr6PEzgguIZv9PTc48jriT4dQE16x059b&btnExportar=Exportar+a+Excel&gv%24DXSelInput=&gv%24DXKVInput=%5B%5D&gv%24CallbackState=BwMHAgIERGF0YQbrCAAAAADSrBcA0qwXAAAAAAAPAAAAAA8AAAAHSWRfQ2l0YQdJZF9DaXRhAwAABEFuaW8EQW5pbwMAAANNZXMDTWVzAwAAA0RpYQNEaWEDAAAORmVjaGFfQXRlbmNpb24ORmVjaGFfQXRlbmNpb24HAAAETG90ZQRMb3RlBwAAB051bV9QYWcHTnVtX1BhZwMAAAdOdW1fUmVnB051bV9SZWcDAAASSWRfRXN0YWJsZWNpbWllbnRvEklkX0VzdGFibGVjaW1pZW50bwMAAAtJZF9QYWNpZW50ZQtJZF9QYWNpZW50ZQcAAAtJZF9QZXJzb25hbAtJZF9QZXJzb25hbAcAAA5JZF9SZWdpc3RyYWRvcg5JZF9SZWdpc3RyYWRvcgMAAAtDb2RpZ29fSXRlbQtDb2RpZ29fSXRlbQcAABBUaXBvX0RpYWdub3N0aWNvEFRpcG9fRGlhZ25vc3RpY28HAAAJVmFsb3JfTGFiCVZhbG9yX0xhYgcAABkAAAAGSWRfVXBzDklkX0ZpbmFuY2lhZG9yHElkX0NvbmRpY2lvbl9Fc3RhYmxlY2ltaWVudG8VSWRfQ29uZGljaW9uX1NlcnZpY2lvCEVkYWRfUmVnCVRpcG9fRWRhZBRBbmlvX0FjdHVhbF9QYWNpZW50ZRNNZXNfQWN0dWFsX1BhY2llbnRlE0RpYV9BY3R1YWxfUGFjaWVudGUISWRfVHVybm8OSWRfQ29ycmVsYXRpdm8SSWRfQ29ycmVsYXRpdm9fTGFiBFBlc28FVGFsbGELSGVtb2dsb2JpbmETUGVyaW1ldHJvX0FiZG9taW5hbBJQZXJpbWV0cm9fQ2VmYWxpY28RSWRfT3RyYV9Db25kaWNpb24RSWRfQ2VudHJvX1BvYmxhZG8SRmVjaGFfVWx0aW1hX1JlZ2xhEkZlY2hhX1NvbGljaXR1ZF9IYhJGZWNoYV9SZXN1bHRhZG9fSGIORmVjaGFfUmVnaXN0cm8SRmVjaGFfTW9kaWZpY2FjaW9uB0lkX1BhaXMHAAcABwAHAAb%2F%2FwMFwccSDAMG4wcDBwEDBwEHAgoyMDE5LTAxLTAxBwIBNQMHAQMHCwMGiREHAgwyMDgzNjM5NzQ0ODkHAgo0NjE4Nzg0NDg5AwXSozwABwIETjM5MAcCAUQHAgAHAAcABv%2F%2FAwXfcwUMAwbjBwMHAQMHAQcCCjIwMTktMDEtMDEHAgIwMwMHAQMHAwMGFRIHAgZBUFAxMzYHAgwyOTgwODU0OTQ2MjkDBbDDVAAHAgVDMDAwOQcCAUQHAgE0BwAHAAb%2F%2FwMFCf86DAMG4wcDBwEDBwEHAgoyMDE5LTAxLTAxBwIBMQMHAQMHAgMGdxIHAgszNTc5OTE5NDcyNwcCCjEzMTI1NzQ3MjcDBhM9BwIEUzAxNAcCAUQMBwAHAAb%2F%2FwMFppsKFAMG4wcDBwEDBwEHAgoyMDE5LTAxLTAxBwICUzQDBwEDBwkDBowTBwIMMjUzNjYxMjI1MDA0BwIKNDY0ODM4NTAwNAMFwxcHAAcCBTgxMDAyBwIBRAcCAlJOBwAHAAb%2F%2FwMFfFDyCwMG4wcDBwEDBwEHAgoyMDE5LTAxLTAxBwIBMQMHDgMHBAMG4hEHAgwxNzkzNjY2NzQ1NzgHAgwyODk2MjE5OTQ1NzgDBQ0PBwAHAgU5OTQwMQcCAUQHAgExBwAHAAb%2F%2FwMFfFDyCwMG4wcDBwEDBwEHAgoyMDE5LTAxLTAxBwIBMQMHDgMHBAMG4hEHAgwxNzkzNjY2NzQ1NzgHAgwyODk2MjE5OTQ1NzgDBQ0PBwAHAgVDODAwMgcCAUQHAgExBwAHAAb%2F%2FwMFfFDyCwMG4wcDBwEDBwEHAgoyMDE5LTAxLTAxBwIBMQMHDgMHBAMG4hEHAgwxNzkzNjY2NzQ1NzgHAgwyODk2MjE5OTQ1NzgDBQ0PBwAHAgRJMTBYBwIBUgwHAAcABv%2F%2FAwV8UPILAwbjBwMHAQMHAQcCCjIwMTktMDEtMDEHAgExAwcOAwcEAwbiEQcCDDE3OTM2NjY3NDU3OAcCDDI4OTYyMTk5NDU3OAMFDQ8HAAcCBFowMDgHAgFEBwIBRQcABwAG%2F%2F8DBdZjChQDBuMHAwcBAwcBBwIKMjAxOS0wMS0wMQcCATcDBwIDBwQDBh8cBwIMMTc3ODcxNjQ3MTk5BwILMjg3MTI5MTcxOTkDBZ0AJAAHAgRLMzBYBwIBRAwHAAcABv%2F%2FAwX7e%2FwLAwbjBwMHAQMHAQcCCjIwMTktMDEtMDEHAgExAwcCAwcBAwYoLwcCDTM3NjQ2NTQ1MTIwNzIHAgs0NjUzODcxMjA3MgMFfMYFAAcCBFowMDYHAgFEBwICRUQHAAcABv%2F%2FAwUFTRkMAwbjBwMHAQMHAQcCCjIwMTktMDEtMDEHAgExAwcBAwcLAwbrJgcCDDIyMjI4NjgwOTk2MwcCDDM3NDg2MDc5OTk2MwMFWM14AQcCCDk5NDAyLjA4BwIBRAcCATEHAAcABv%2F%2FAwVlkRoMAwbjBwMHAQMHAQcCCjIwMTktMDEtMDEHAgExAwcCAwcCAwaVJgcCDDI0MDgzNDc2OTg3NwcCCjQ3MDY0Mjk4NzcDBaCzqAEHAgRKMDM5BwIBRAwHAAcABv%2F%2FAwWNbPELAwbjBwMHAQMHAQcCCjIwMTktMDEtMDEHAgNRMDMDBwEDBwEDBioSBwIMMTk5ODAxODM0NjUwBwIMMTgwMTg2MTk0NjUwAwVZjjgCBwIFWjMwNDgHAgFEBwIBNAcABwAG%2F%2F8DBY1s8QsDBuMHAwcBAwcBBwIKMjAxOS0wMS0wMQcCA1EwMwMHAQMHAQMGKhIHAgwxOTk4MDE4MzQ2NTAHAgwxODAxODYxOTQ2NTADBVmOOAIHAgVaMzA0OAcCAUQHAgIzMAcABwAG%2F%2F8DBaREnQ4DBuMHAwcBAwcBBwIKMjAxOS0wMS0wMQcCAUcDBwEDBwEDBpETBwIMMzYzOTI5OTU1MDA5BwIMMjAzOTUwMTY1MDA5AwXV%2BWoBBwIFOTk0MTEHAgFEBwIBNgIFU3RhdGUHcwcQBwACAQcBAgEHAgIBBwMCAQcEAgEHBQIBBwYCAQcHAgEHCAIBBwkCAQcKAgEHCwIBBwwCAQcNAgEHDgIBBw8CAQcABwAHAAcAAgAFAAAAgAkCAAcACQIAAgADBwQCAAcAAgEF0qwXAAcAAgEHAAcABwACCFBhZ2VTaXplAwcP&hdpidsector=7&hdpiddisa=7&hdpidred=&hdpidmicrored=&hdpidestablecimiento=&hdpidpunto=7759&hdpfecini=20200501&hdpfecfin=20200531&DXScript=1_171%2C1_94%2C1_164%2C1_104%2C1_138%2C1_114%2C1_121%2C1_152&DXCss=0_3598%2C0_3741%2C1_12%2C0_3600%2C0_3745%2C0_3592%2C1_5%2C0_3594",
            "method": "POST",
            "mode": "cors"
          }).then(res => {
              console.log('inicio')
              console.log(res)
            res.body.pipe(rpt);
            console.log('termino')
                     
           }); 




           fetch("https://wsalud.minsa.gob.pe/reporteshis/his/ExportarMaestroPaciente.aspx?parametro=7758-7-08-01-20201123-20201123-", {
  "headers": {
    "accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
    "accept-language": "es-ES,es;q=0.9,en;q=0.8",
    "cache-control": "no-cache",
    "content-type": "application/x-www-form-urlencoded",
    "pragma": "no-cache",
    "sec-fetch-dest": "iframe",
    "sec-fetch-mode": "navigate",
    "sec-fetch-site": "same-origin",
    "sec-fetch-user": "?1",
    "upgrade-insecure-requests": "1",
    "cookie": "_ga=GA1.3.2012850145.1568573608; __cfduid=d455db6626cff542e92e41f50bf3077e71604958158; rxVisitor=1606006205279UM3J2CU0EVB0B3NA2T64IS2MMQG8OLBL; ASP.NET_SessionId=xmqcd4hhuipaeyre2skgvl1k; dtSa=-; dtPC=3$508208698_818h-vIQXMPVLCBEVVOHXYAUUBBXMVFLSUVMSP; dtLatC=1; dtCookie=3$9NUBFSES42MTE6SV6SR7PJBM28KTMBQG|HISMINSA|1; rxvt=1606110012749|1606106956076"
  },
  "referrer": "https://wsalud.minsa.gob.pe/reporteshis/his/ExportarMaestroPaciente.aspx?parametro=7758-7-08-01-20201123-20201123-",
  "referrerPolicy": "strict-origin-when-cross-origin",
  "body": "__EVENTTARGET=&__EVENTARGUMENT=&__VIEWSTATE=%2FwEPDwUKMTEwNzU3MTUxNA9kFgICAw9kFgQCAw8PFgIeBFRleHQFF1RvdGFsIGRlIHJlZ2lzdHJvcyA0ODgxZGQCBQ88KwAcAgAPFgIeD0RhdGFTb3VyY2VCb3VuZGdkGDwrAAYBBRQrAAJkZGQYAQUeX19Db250cm9sc1JlcXVpcmVQb3N0QmFja0tleV9fFgEFAmd2jUDub3Vh2sBa4rU87h1ZP8C0d2g8bSm8M5EBAMM5c70%3D&__VIEWSTATEGENERATOR=7CA80B8B&__EVENTVALIDATION=%2FwEdAAvNvw%2FGT8%2BwO0s0HO5H6Vg560z594LnSzU4S6PQAbT3rq%2FpNZX4WBzijQTqPezGz2cPw6yb2%2B8wFVL9OLFMP7J7pAiCeLToo4O3HlO4yQxlIfvcNFoQPNiM7bg%2FOngY3P4BkA6huflNnawEEAJHB5G4AuunurLj5OiQui6dRwAtUPWzZLxWMw9LZCkW1r1wQWtVmqd7cYVwF0CgV957j5RekmEIlqWRw%2Bgtywck79wWECW8pnUzPlOmXPu6xya0FuQ3UzRLp7%2FD57fuX%2FJsXBx%2B&btnExportar=Exportar+a+Excel&gv%24DXSelInput=&gv%24DXKVInput=%5B%5D&gv%24CallbackState=BwMHAgIERGF0YQbHBgAAAAAREwAAERMAAAAAAAAPAAAAAAcAAAALSWRfUGFjaWVudGULSWRfUGFjaWVudGUHAAARSWRfVGlwb19Eb2N1bWVudG8RSWRfVGlwb19Eb2N1bWVudG8DAAAQTnVtZXJvX0RvY3VtZW50bxBOdW1lcm9fRG9jdW1lbnRvBwAAGUFwZWxsaWRvX1BhdGVybm9fUGFjaWVudGUZQXBlbGxpZG9fUGF0ZXJub19QYWNpZW50ZQcAABlBcGVsbGlkb19NYXRlcm5vX1BhY2llbnRlGUFwZWxsaWRvX01hdGVybm9fUGFjaWVudGUHAAAQTm9tYnJlc19QYWNpZW50ZRBOb21icmVzX1BhY2llbnRlBwAAEEZlY2hhX05hY2ltaWVudG8QRmVjaGFfTmFjaW1pZW50bwcAAA4AAAAGR2VuZXJvCElkX0V0bmlhEEhpc3RvcmlhX0NsaW5pY2EORmljaGFfRmFtaWxpYXIRVWJpZ2VvX05hY2ltaWVudG8NVWJpZ2VvX1JlbmllYxBEb21pY2lsaW9fUmVuaWVjEFViaWdlb19EZWNsYXJhZG8TRG9taWNpbGlvX0RlY2xhcmFkbxRSZWZlcmVuY2lhX0RvbWljaWxpbwdJZF9QYWlzEklkX0VzdGFibGVjaW1pZW50bwpGZWNoYV9BbHRhEkZlY2hhX01vZGlmaWNhY2lvbgcABwAHAAcABv%2F%2FBwIMMTAwMzQyOTg0NTM5AwcBBwIIMjcxNjkzMTMHAgZOVcORRVoHAgVNQUxDQQcCBUhJTERBBwIKMTk3MS0wNi0yMQcABwAG%2F%2F8HAgwxMDAzNTc2NDQ1MzcDBwEHAgg0NDU2OTE2MQcCCUhFUk5BTkRFWgcCB1JBTUlSRVoHAgxTQU5UQSBZU0FCRUwHAgoxOTg0LTExLTAxBwAHAAb%2F%2FwcCDDEwMzUwNjQwNDUzOAMHAQcCCDI4MDYzNDYwBwIFVEVSQU4HAglIRVJOQU5ERVoHAg5XQUxURVIgT1JMQU5ETwcCCjE5NjItMDMtMjMHAAcABv%2F%2FBwIMMTAzNTIyMjk0NTM5AwcBBwIIMjcxNTQxMDMHAgZMT1pBTk8HAghFU1BJTk9aQQcCBUpFU1VTBwIKMTk0OC0wMS0yMQcABwAG%2F%2F8HAgwxMDM5MDc1MzQ1NDADBwEHAgg0ODcwOTU5MwcCB01FTkRPWkEHAgZMT1pBTk8HAghDQVJPTElOQQcCCjE5NDYtMTEtMDEHAAcABv%2F%2FBwIMMTAzOTA4MzA0NTQwAwcBBwIIMjc5ODUyNjgHAgZIVUFNQU4HAgZQQVVDQVIHAglDTEFSQSBMVVoHAgoxOTc0LTA0LTA0BwAHAAb%2F%2FwcCDDEwMzkxMTYxNDU0MAMHAQcCCDQ4MDQ2MTg5BwIHVkFTUVVFWgcCB0JFQ0VSUkEHAgZBVVJPUkEHAgoxOTQzLTA4LTExBwAHAAb%2F%2FwcCDDEwODQzMDIzNDU0MAMHAQcCCDcwOTEwMzM4BwIHQ0FCUkVSQQcCCU1BTk9TQUxWQQcCC0ZBTlkgTUFERUxJBwIKMTk5NC0wMi0yNgcABwAG%2F%2F8HAgwxMDk5MDY2NzQ1MzkDBwEHAgg0NTk4NDkzOAcCBlJPTUVSTwcCBVZJTExBBwIRQVNVTkNJT04gR0VSRU1JQVMHAgoxOTg5LTA1LTI0BwAHAAb%2F%2FwcCDDExMDE4MTA0NDUzOQMHAQcCCDcxMTIzOTU4BwIGQUNVw5FBBwIGTE9aQU5PBwIOTUlSRVlMSSBZQU5FTEkHAgoxOTk3LTA1LTIwBwAHAAb%2F%2FwcCCzEzNDQwNzc0NTM4AwcBBwIINDUwODIyMTcHAgVDQUxMQQcCB1ZBU1FVRVoHAgpKVUxJQSBST1NBBwIKMTk0Mi0wNi0wMQcABwAG%2F%2F8HAgwxMzQ1MDY3MjQ1MzcDBwEHAggwNzk3MDIzNAcCB1ZFTlRVUkEHAgdNRU5ET1pBBwIFVklMTUEHAgoxOTY4LTA0LTAzBwAHAAb%2F%2FwcCCzEzODA0MDI0NTM4AwcBBwIIODA0MTYwNTUHAgZRVUlST1oHAgdDUlVaQURPBwIHWkVOQUlEQQcCCjE5NDMtMDYtMTIHAAcABv%2F%2FBwIMMTQ4Mjc5Mjk0NTM5AwcBBwIIMTAxNTQxODYHAglCQVJSQU5URVMHAgZST01FUk8HAglBTkEgTUFSSUEHAgoxOTY3LTA4LTE1BwAHAAb%2F%2FwcCCzE1ODQxMTE0NTM4AwcBBwIINDc3NjMzOTEHAgRNT1pBBwIHQU1BTUJBTAcCBkFVUk9SQQcCCjE5NDAtMTAtMDECBVN0YXRlB1EHCAcAAgEHAQIBBwICAQcDAgEHBAIBBwUCAQcGAgEHBwIBBwAHAAcABwACAAUAAACACQIABwAJAgACAAMHBAIABwACAQYREwcAAgEHAAcABwACCFBhZ2VTaXplAwcP&hdidsector=7&hdiddisa=7&hdidred=02&hdidmicrored=01&hdidestablecimiento=&hdidpunto=21&hdfecini=20201123&hdfecfin=20201123&DXScript=1_171%2C1_94%2C1_164%2C1_104%2C1_138%2C1_114%2C1_121%2C1_152&DXCss=0_3598%2C0_3741%2C1_12%2C0_3600%2C0_3745%2C0_3592%2C1_5%2C0_3594",
  "method": "POST",
  "mode": "cors"
}).then(res => {
  console.log('inicio')
  console.log(res)
res.body.pipe(dest);
console.log('termino descargar maestro paciente')
         
}); ;



          }




          

}
